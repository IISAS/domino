.. _domino-pieces-repo-page:

Pieces repository
================================

.. tip:: The easiest way to start your Pieces repository is to use our `Template for Pieces repository <https://github.com/Tauffer-Consulting/domino_pieces_repository_template>`_

A Pieces repository is a Git repository that contains multiple Pieces available to be used in Domino Workflows.
A Domino Pieces repository should contain:

- a :code:`pieces/` folder containing all :ref:`Pieces<domino-pieces-repository-piecefolder>` folders
- a :ref:`dependencies/<domino-pieces-repository-dependencies>` folder with all :code:`Dockerfile` and :code:`requirements.txt` files defined as Pieces dependencies
- a :ref:`config.toml<domino-pieces-repository-config>` configuration file

.. code-block::
   :caption: Repository folders and files structure

    dependencies/
    ├── Dockerfile_1
    ├── requirements_1.txt
    └── requirements_2.txt
    pieces/
    └── FirstPiece/
        ├── metadata.json
        ├── models.py
        └── piece.py
    └── SecondPiece/
        ├── metadata.json
        ├── models.py
        └── piece.py
    config.toml


.. _domino-pieces-repository-piecefolder:

Piece Folder
-----------------------

The :code:`pieces/` folder should contain all the Pieces in the repository. Each Piece folder name should have the sufix :code:`Piece` and follow a standard organization and contain certain information to be able to be found and used by your deployed Domino instance. Example: 

.. code-block::
   :caption: Piece folder example

    pieces/
    └── FirstPiece/
        ├── metadata.json
        ├── models.py
        └── piece.py

For detailed information on how to create a Piece, see :ref:`Pieces<domino-pieces-page>`.


.. _domino-pieces-repository-dependencies:

Dependencies
------------------------

The :code:`/dependencies` folder should contain all the :code:`requirements.txt` and :code:`Dockerfile` files that were defined as dependencies in the :code:`metadata.json` files of the Pieces in this repository. Example:

.. code-block::
   :caption: Dependencies folder example

    dependencies/
    ├── Dockerfile_1
    ├── requirements_1.txt
    └── requirements_2.txt


.. _domino-pieces-repository-config:

config.toml
------------------------------

The :code:`config.toml` file stores the configuration variables for the repository. Example:

.. code-block:: toml
   :caption: Repository's configuration file

    [repository]
    # The name of the github owner, must be in lower-case letters
    REGISTRY_NAME = "github_owner_name"

    # The name of this Pieces repository
    REPOSITORY_NAME = "example_pieces"

    # The label of this Pieces repository, as it will appear in Domino GUI
    REPOSITORY_LABEL = "OpenAI Domino Pieces"
    
    # The version of this Pieces release
    VERSION = "0.1.0"
    


Files generated by :code:`domino organize`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When using Domino convenience CLI functions to prepare your code repository to run, some files will be automatically created or modified for you inside the :code:`/.domino` folder:

- A :code:`dependencies_map.json` file
- A :code:`compiled_metadata.json` file

.. tip:: Using our `Template for Pieces repository <https://github.com/Tauffer-Consulting/domino_pieces_repository_template>`_ will automatically run :code:`domino organize` (with Github actions) for every commit to :code:`main` branch. See more below.


Github actions
----------------------

Our `Template for Pieces repository <https://github.com/Tauffer-Consulting/domino_pieces_repository_template>`_ provides out-of-the box Github actions to validate, organize and publish your Pieces images.

Go to :code:`Settings -> Action -> General -> Workflow permissions` and choose :code:`read and write permissions` to allow the Github actions to push to your repository.



.. raw:: html

    <div id="carouselExampleControls" class="carousel slide" data-interval="false">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" src="_static/media/pieces_repository_slide_1.png" alt="First slide">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="_static/media/pieces_repository_slide_2.png" alt="Second slide">
            </div>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>